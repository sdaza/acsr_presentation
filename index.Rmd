---
title       : acsr package
subtitle    : some examples
author      : Sebastian Daza
job         : PhD Candidate
framework   : io2012      # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js
hitheme     : solarized_light
widgets     : [mathjax]  # {mathjax, quiz, bootstrap}     
--- 

## Install `acsr` package in `R`


```
# set server
options(repos=structure(c(CRAN="http://rweb.quant.ku.edu/cran/")))

# install from cran
install.packages("devtools")
install.packages("acs")

# install from github
devtools::install_github("Rdatatable/data.table", build_vignettes = FALSE)

# install acsr package
devtools::install_github("sdaza/acsr")
```

---

## Load `acsr` and help files

- Remember to set the API key for the `acs` package. You have to do it only once.

    ```
    api.key.install(key="")
    ```

- Explore help files of the main functions: 

    ```
    library(acsr)
    ?acsdata
    ?sumacs
    ```
- Check defaults!
 
      - State = WI
      - Year  = 2013
      - Span = 5
      - Level = county

---

## Why to use the `acsdata` function?

- To download the data can be slow, specially when there are many geographic/administrative levels
-  A better approach might be to download the data first, and then use them as input with the `sumacs` function 

    ```{r, echo=FALSE }
    library(acsr)
    ```

    ```{r }
    d <- acsdata(formula = "(b16004_004 + b16004_026 + b16004_048 / b16004_001)",
     level = "county")
    ```

- This will create a list with ACS objects.

---

## Let's now use the `sumacs` function

```{r }
tab <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048 / b16004_001)", 
varname = "langspan0913", method = "prop", data = d)
tab[1:3, c(1:4,11:12), with = FALSE]
```

--- 

## Some options: `format.out`

```{r }
tab <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048 / b16004_001)", 
varname = "langspan0913", method = "prop", data = d, format.out = "long")
tab[1:3, c(1:4,11:13), with = FALSE]
```

--- 

## Some options: `file`

```{r }
tab <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048 / b16004_001)", 
varname = "langspan0913", method = "prop", data = d, file = "d.csv")
```

--- 

## Some options: `one.zero`

```{r, warning=FALSE, message=FALSE, results="hide"}
tab1 <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048) / b16004_001", 
varname = "langspan0913", method = "prop", level = "tract", county = 1, 
tract = 950501, one.zero = FALSE)
```

```{r, echo = FALSE}
  tab1[, c(1,6, 11:12), with = FALSE]
```

```{r, warning=FALSE, message=FALSE,  results="hide"}
tab2 <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048) / b16004_001", 
varname = "langspan0913", method = "prop", level = "tract", county = 1, 
tract = 950501, one.zero = TRUE)
```

```{r, echo = FALSE}
tab2[, c(1,6, 11:12), with = FALSE]
```

---

## Some options: `one.zero`

- one.zero = FALSE

    ```{r, eval = TRUE}
    ( sqrt(( 5.4711125 ^ 2 + 22.4924 ^ 2 + 5.4711125 ^ 2 ) - 
    ( 0.0226390685640362 ^ 2 * 102.1277 ^ 2 )) / 1546) * 1.645
    ```

- one.zero = TRUE

    ```{r, eval = TRUE}
    ( sqrt(( 5.4711125 ^ 2 + 22.4924 ^ 2) - 
    ( 0.0226390685640362 ^2 * 102.1277 ^ 2 )) / 1546) * 1.645 
    ```

---

## Some options: `one.zero` and `ratio`

- method = "ratio" and one.zero = FALSE

    ```{r, warning=FALSE, message=FALSE,  results="hide"}
    tab3 <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048) / b16004_001", 
    varname = "langspan0913", method = "ratio", level = "tract", county = 1, 
    tract = 950501, one.zero = FALSE)
    ```

    ```{r, echo = FALSE}
      tab3[, c(1,6, 11:12), with = FALSE]
    ```

    ```{r, eval = TRUE}
    ( sqrt(( 5.4711125 ^ 2 + 22.4924 ^ 2 + 5.4711125 ^ 2 ) 
    + ( 0.0226390685640362 ^ 2 * 102.1277 ^ 2 )) / 1546) * 1.645
    ```

---

## Some options: `one.zero` and `ratio`

- method = "ratio" and one.zero = TRUE 

    ```{r, warning=FALSE, message=FALSE,  results="hide"}
    tab3 <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048) / b16004_001", 
    varname = "langspan0913", method = "ratio", level = "tract", county = 1, 
    tract = 950501, one.zero = TRUE)
    ```

    ```{r, echo = FALSE}
      tab3[, c(1,6, 11:12), with = FALSE]
    ```

    ```{r, eval = TRUE}
    ( sqrt(( 5.4711125 ^ 2 + 22.4924 ^ 2 ) 
    + ( 0.0226390685640362 ^ 2 * 102.1277 ^ 2 )) / 1546) * 1.645
    ```

---

## Some options: `one.zero` and `agg`

- method = "agg" and one.zero = FALSE 

    ```{r,  results="hide"}
    tab4 <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048)", 
    varname = "test", method = "agg", level = "tract", county = 1, 
    tract = 950501, one.zero = FALSE)
    ```

    ```{r, echo = FALSE}
      tab4[, c(1,6, 11:12), with = FALSE]
    ```

    ```{r, eval = TRUE}
    sqrt((5.4711125^2 + 22.4924^2 + 5.4711125^2))  * 1.645
    ```

---

## Some options: `one.zero` and `agg`

- method = "agg" and one.zero = TRUE 

    ```{r,  results="hide"}
    tab4 <- sumacs(formula = "(b16004_004 + b16004_026 + b16004_048)", 
    varname = "test", method = "agg", level = "tract", county = 1, 
    tract = 950501, one.zero = TRUE)
    ```

    ```{r, echo = FALSE}
      tab4[, c(1,6, 11:12), with = FALSE]
    ```

    ```{r, eval = TRUE}
    sqrt(( 5.4711125 ^ 2 + 22.4924 ^ 2)  * 1.645
    ```

___ 
